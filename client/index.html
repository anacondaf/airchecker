<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- This one is important for the manifest. -->
    <meta name="theme-color" content="#0d085c" />

    <!-- GG Font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://kit.fontawesome.com/3e6c5ff1db.js" crossorigin="anonymous"></script>

    <!-- Chartjs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- SocketIO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <!-- Reference the manifest file for PWA -->
    <link rel="manifest" href="./manifest.json" />

    <!-- Reference the icons -->
    <link rel="shortcut icon" href="assets/icons/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="assets/icons/favicon.ico" type="image/x-icon">

    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png">

    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- frenchkiss -->
    <script src="https://cdn.jsdelivr.net/npm/frenchkiss/dist/umd/frenchkiss.js"></script>

    <!-- i18next -->
    <script src="https://cdn.jsdelivr.net/npm/i18next@21.6.10/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-i18next@1.2.1/jquery-i18next.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@6.1.3/i18nextBrowserLanguageDetector.min.js"></script>

    <!-- jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

    <!-- MomentJS -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>

    <!-- Shepherd -->
    <script src="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/js/shepherd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@10.0.1/dist/css/shepherd.css" />

    <title>AirChecker</title>
</head>

<body>
    <div class="container">
        <div class="left-panel">
            <section class="top section">
                <div class="top-left">
                    <h1 data-i18n="intro.title"></h1>
                    <p><span id="today"></span> - <span data-i18n="intro.location"></span> </p>
                </div>

                <div class="dropdown">
                    <div class="language-button" id="language-button" onclick="langDropdownClick()">
                        <img src="assets/flags/uk.png" class="lang en">
                    </div>

                    <div id="lang-drop-down" class="dropdown-content">
                        <div class="lang-box" id="lang-box" onclick="langBoxOnClick(this)">
                            <p>Tiếng Việt</p>
                            <img src="assets/flags/vn.png" class="lang vn">
                        </div>

                        <div class="lang-box" id="lang-box" onclick="langBoxOnClick(this)">
                            <p>English</p>
                            <img src="assets/flags/uk.png" class="lang en">
                        </div>
                    </div>
                </div>

                <div class="top-divider"></div>
            </section>

            <div class="divider"></div>

            <section class="time-seriers-db">
                <div class="air-info">
                    <div class="index-circle">
                        <div class="index">
                            <span id="aqi"></span>
                        </div>
                    </div>

                    <div class="text">
                        <h4 id="aqi-level">-</h4>
                        <p id="aqi-desc">-</p>
                    </div>
                </div>


                <div class="chart-container">
                    <canvas id="myChart"></canvas>
                </div>
            </section>

            <div class="divider"></div>

            <section class="forecast section">
                <p data-i18n="forecast.title" style="margin-bottom: 1.5em;">Daily forecast</p>

                <div class="inner-wrap">
                    <div class="forecast-box">
                        <div class="forecast-left">
                            <div class="forecast-level">
                                <h5>Good</h5>
                            </div>

                            <h5 class="forecast-dates"></h5>

                            <div class="forecast-aqi">
                                <h5 data-i18n="forecast.aqi">Air Quality Index</h5>
                                <h1 id="forecast-aqi">99</h1>
                            </div>
                        </div>

                        <div class="forecast-right">
                            <div class="forecast-right-wrapper">
                                <img src="assets/aqi_icon/1.png" id="forecast-aqi-icon">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="inner-wrap">
                    <div class="forecast-box">
                        <div class="forecast-left">
                            <div class="forecast-level">
                                <h5>Hazardous</h5>
                            </div>

                            <h5 class="forecast-dates"></h5>

                            <div class="forecast-aqi">
                                <h5 data-i18n="forecast.aqi">Air Quality Index</h5>
                                <h1 id="forecast-aqi">99</h1>
                            </div>
                        </div>

                        <div class="forecast-right">
                            <div class="forecast-right-wrapper">
                                <img src="assets/aqi_icon/1.png" id="forecast-aqi-icon">
                            </div>
                        </div>

                    </div>
                </div>

                <!-- <div class="inner-wrap">
                    <div class="forecast-box">
                        <div class="forecast-left">
                            <div id="forecast-level">
                                <h5>Good</h5>
                            </div>

                            <div class="forecast-aqi">
                                <h5 data-i18n="forecast.aqi">Air Quality Index</h5>
                                <h1 id="forecast-aqi">99</h1>
                            </div>
                        </div>

                        <div class="forecast-right">
                            <div class="forecast-right-wrapper">
                                <img src="assets/aqi_icon/1.png" id="forecast-aqi-icon">
                            </div>
                        </div>

                    </div>
                </div> -->
            </section>

            <div class="divider"></div>
        </div>

        <div class="right-panel">
            <div class="detail-pollutants">
                <div class="accordion" onmousedown="accordion(event)" ontouchstart="accordion(event)">
                    <p data-i18n="accordion.title" id="accordion-title">View detail pollutants</p>
                    <i class=" fa-solid fa-caret-down" id="acc-icon"></i>
                </div>

                <div class="panel-wrapper">
                    <div class="panel">
                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.co"></p>
                                <p>(ppm)</p>
                            </div>

                            <div class="index-pollutant" id="co-index">
                                <span id="co"></span>
                            </div>
                        </div>

                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.tvoc"></p>
                                <p>(ppb)</p>
                            </div>

                            <div class="index-pollutant" id="tvoc-index">
                                <span id="tvoc"></span>
                            </div>
                        </div>

                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.o3"></p>
                                <p>(ppm)</p>
                            </div>

                            <div class="index-pollutant" id="o3-index">
                                <span id="o3"></span>
                            </div>
                        </div>

                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.pm25"></p>
                                <p>(ug/m3)</p>
                            </div>

                            <div class="index-pollutant" id="pm25-index">
                                <span id="pm25"></span>
                            </div>
                        </div>

                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.temp"></p>
                                <p>(&deg;C)</p>
                            </div>

                            <div class="index-pollutant">
                                <span id="temp">nan</span>
                            </div>
                        </div>

                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.humid"></p>
                                <p>(%)</p>
                            </div>

                            <div class="index-pollutant">
                                <span id="humidity"></span>
                            </div>
                        </div>

                        <div class="pollutant-card">
                            <div class="info">
                                <p data-i18n="pollutant.co2"></p>
                                <p>(ppm)</p>
                            </div>

                            <div class="index-pollutant">
                                <span id="co2"></span>
                            </div>
                        </div>
                    </div>

                    <p class="updated-time">
                        Last updated: <span id="updated-time-span">1 min ago</span>
                    </p>
                </div>


            </div>
        </div>

        <div class="floating-action-button" id="fab" onmousedown="fabHandler(event)" ontouchstart="fabHandler(event)">
            <img alt="fab-book" class="fab-book" src="assets/fabtn_icons/icons8-book-48.png">
        </div>

        <div class="guide-book" id="guide-book">
            <canvas id="guid-book-canvas"></canvas>
        </div>
    </div>

    <script src="swiped-events.js"></script>
    <script src="main.js"></script>
    <script src="scripts/pwa_handler.js"></script>
    <script src="service-worker.js"></script>

    <script type="module">
        let guideBook = document.getElementById('guide-book');

        import { getDocument, GlobalWorkerOptions } from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.269/pdf.min.mjs';

        GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.269/pdf.worker.min.mjs';

        const url = 'https://res.cloudinary.com/dv1jbd8mq/image/upload/v1701714215/Air_Quality_Index_Technical_Document_ti9jpa.pdf';

        let pdfDoc = null,
            pageNum = 1,
            pageRendering = false,
            pageNumPending = null,
            canvas = document.getElementById('guid-book-canvas'),
            ctx = canvas.getContext('2d');

        function renderPage(num) {
            pageRendering = true;

            pdfDoc.getPage(num).then(function (page) {
                var viewport = page.getViewport({ scale: 0.7 });

                let windowWidth = window.innerWidth;
                let windowHeight = window.innerHeight;

                if (windowWidth > 500) {
                    windowWidth = 500;
                }

                var scale = Math.min((windowWidth - 32) / viewport.width, windowHeight / viewport.height);

                var scaledViewport = page.getViewport({ scale: scale });
                canvas.height = scaledViewport.height;
                canvas.width = scaledViewport.width;

                var renderContext = {
                    canvasContext: ctx,
                    viewport: scaledViewport
                };

                var renderTask = page.render(renderContext);

                renderTask.promise.then(function () {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });
        }

        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        function onPrevPage() {
            if (pageNum <= 1) {
                return;
            }

            pageNum--;
            queueRenderPage(pageNum);
        }

        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) {
                return;
            }

            pageNum++;
            queueRenderPage(pageNum);
        }

        document.addEventListener("swiped-left", function (e) {
            onNextPage();
        });

        document.addEventListener("swiped-right", function (e) {
            onPrevPage();
        });

        getDocument(url).promise.then(function (pdfDoc_) {
            pdfDoc = pdfDoc_;
            renderPage(pageNum);
        });

        let isDown = false;
        let startX;
        let endX;

        canvas.addEventListener('mousedown', (e) => {
            isDown = true;
            startX = e.pageX;
        });

        canvas.addEventListener('mouseup', (e) => {
            if (isDown) {
                endX = e.pageX;
                let distance = Math.abs(endX - startX);

                if (distance < 10) {
                    guideBook.style.display = "none";
                } else {
                    if (endX > startX) {
                        onPrevPage();
                    } else if (endX < startX) {
                        onNextPage();
                    }
                }
            }
            isDown = false;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            endX = e.pageX;
        });


        guideBook.addEventListener('click', (e) => {
            if (e.target == guideBook) {
                guideBook.style.display = "none";
            }
        })
    </script>
</body>

</html>